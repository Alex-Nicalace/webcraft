@use 'sass:math';

$aspect-ratio: '16/7.3';
$aspect-ratio-1280: '16/8.8';
$aspect-ratio-768: '16/9';

@mixin conditionPortrait {
  @media (orientation: portrait) or (min-aspect-ratio: $aspect-ratio),
    (max-width: em($pc)) and (min-aspect-ratio: $aspect-ratio-1280),
    (max-width: em($mobile)) {
    @content;
  }
}

.greeting {
  position: relative;
  min-height: 100vh;
  padding-top: rem(100.4);
  display: flex;
  flex-direction: column;
  justify-content: center;
  gap: rem(20);

  @include mdQuery(0, $pc) {
    padding-top: rem(80.39);
  }

  @include mobileSmall {
    padding-top: rem(69.8);
  }

  @include conditionPortrait {
    min-height: auto;
    padding-top: rem(100.4 + 70);

    @include mdQuery(0, $pc) {
      padding-top: rem(80.39 + 70);
    }

    @include mobileSmall {
      padding-top: rem(69.8 + 50);
    }
  }
  // .greeting__wrapper
  &__wrapper {
    position: relative;
    flex: 0 0 vh(860, 1080);

    @include conditionPortrait {
      flex: 1 0 auto;
      aspect-ratio: 1800 / 861;

      @include mobile-d {
        aspect-ratio: 290 / 164;
      }
    }
  }
  // .greeting__puzzle
  &__puzzle {
    $puzzle-width: 1800;
    $puzzle-height: 860;
    $bg-width: 2383;
    $bg-height: 2384;
    $bg-pos-x: -292;
    $bg-pos-y: -861;

    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url(../../assets/img/puzzles/puzzle_bg_3.jpg);
    background-repeat: no-repeat;
    background-size: percent($bg-width, $puzzle-width)
      percent($bg-height, $puzzle-height);
    background-position: percent($bg-pos-x, $puzzle-width - $bg-width)
      percent($bg-pos-y, $puzzle-height - $bg-height);
    clip-path: url(#puzzle-main-screen);
    z-index: -1;
  }
  // .greeting__mask
  &__mask {
    position: absolute;
    width: 0;
    height: 0;
  }
  // .greeting__heading
  &__heading {
    position: absolute;
    padding-inline: percent(50, 1800);
    padding-block: vh(35, 1080); // по макету 50
    left: percent(53, 1800);
    top: percent(218, 860);
    clip-path: url(#puzzle-main-screen-text-bg);
    background-color: var(--bg-pod-tekst);
    backdrop-filter: blur(rem(40));
    box-shadow: 0 rem(4) rem(35) 0 rgba(31, 2, 150, 0.35);

    display: flex;
    flex-direction: column;
    align-items: flex-start;

    /* Только для Firefox. в фокск не обрезается фигура должным образом */
    @-moz-document url-prefix() {
      box-shadow: none;
    }

    @include adaptiveValue('width', 1306, 956, $containerWidth, $pc, 1);

    @include mdQuery(0, $pc) {
      padding-inline: percent(35, 1200);
      padding-block: vh(25, 720);
      @include adaptiveValue('width', 956, 614, $pc, $mobile, 1);
      @media (orientation: portrait) {
        padding-block: percent(25, 720);
      }
    }

    @include mobile-d {
      @include adaptiveValue('width', 614, 268, $mobile);
    }

    span {
      &:last-child {
        margin-top: em(25, 80);
        flex-grow: 1;
        align-self: flex-end;
      }
    }
    @include conditionPortrait {
      padding: percent(10, 728) percent(20, 728);

      @include mobileSmall {
        padding: percent(4, 290);
      }
    }
  }
  // .greeting__text
  &__text {
    position: absolute;
    left: percent(455, 1800);
    top: percent(-35, 860);
  }
  // .greeting__button
  &__button {
    position: absolute;
    right: percent(1144, 1800);
    top: percent(735, 860);

    @include conditionPortrait {
      position: static;
      align-self: center;
    }
  }
  &__ball {
    position: absolute;

    &::before {
      content: '';
      display: block;
      height: 100%;
      border-radius: 100%;
      mix-blend-mode: color-burn;

      box-shadow:
          // эту строку убрать - исчезает проблема
        rem(35) rem(25) rem(50) 0 rgba(0, 0, 0, 0.5),
        inset rem(35) rem(25) rem(55) 0 rgba(0, 0, 0, 0.5),
        inset rem(-35) rem(-25) rem(55) 0 rgba(255, 255, 255, 0.5);
      opacity: 0.8;
    }

    &::after {
      content: '';
      position: absolute;
      border-radius: 100%;
      transform: rotate(-45deg);
      background-color: var(--white);
      filter: blur(rem(80));
    }

    @mixin ball(
      $widthParent: 1800,
      $heightParent: 860,
      $size: null,
      $left: null,
      $top: null,
      $background: null,
      $widthGlare: null,
      $heightGlare: null,
      $leftGlare: null,
      $topGlare: null
    ) {
      @if $size == null {
        width: rem($size);
        height: rem($size);
      }

      @if $left != null {
        left: percent($left, $widthParent);
      }
      @if $top != null {
        top: percent($top, $heightParent);
      }

      @if $background != null {
        &::before {
          background: $background;
        }
      }

      @if $widthGlare !=
        null and
        $heightGlare !=
        null and
        $leftGlare !=
        null and
        $topGlare !=
        null
      {
        &::after {
          width: rem($widthGlare);
          height: rem($heightGlare);
          left: percent($leftGlare, $size);
          top: percent($topGlare, $size);
        }
      }
    }

    &_1 {
      @include ball(
        $size: 313,
        $left: 1661,
        $top: -313 - 24,
        $background: linear-gradient(148deg, #8796d2 0%, rgba(0, 0, 0, 0) 100%),
        $widthGlare: 139,
        $heightGlare: 41,
        $leftGlare: 23,
        $topGlare: 70
      );
    }

    &_2 {
      @include ball(
        $size: 275,
        $left: 1010,
        $top: 60 + 860,
        $background: linear-gradient(133deg, #d9d9d9 0%, rgba(0, 0, 0, 0) 100%),
        $widthGlare: 122,
        $heightGlare: 36,
        $leftGlare: 20,
        $topGlare: 61
      );
    }

    &_3 {
      @include ball(
        $size: 363,
        $left: -192,
        $top: 710,
        $background: linear-gradient(133deg, #d9d9d9 0%, rgba(0, 0, 0, 0) 100%),
        $widthGlare: 162,
        $heightGlare: 48,
        $leftGlare: 27,
        $topGlare: 80
      );
    }
  }
}
